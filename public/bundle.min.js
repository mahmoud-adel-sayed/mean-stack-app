var main=angular.module("main",["ngResource","ngRoute","posts","users","profile"]);main.config(["$locationProvider","$routeProvider",function($locationProvider,$routeProvider){$locationProvider.hashPrefix("!"),$routeProvider.when("/",{templateUrl:"js/posts/views/list-view.client.view.html"}).otherwise({redirectTo:"/"})}]),"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.element(document).ready(function(){angular.bootstrap(document,["main"])}),angular.module("users",[]),angular.module("posts",[]),angular.module("profile",[]),angular.module("posts").config(["$routeProvider",function($routeProvider){$routeProvider.when("/posts/create",{templateUrl:"js/posts/views/create-view.client.view.html"}).when("/posts/:postId",{templateUrl:"js/posts/views/post-view.client.view.html"}).when("/posts/:postId/edit",{templateUrl:"js/posts/views/edit-view.client.view.html"})}]),angular.module("posts").controller("CommentsController",["$scope","$routeParams","Comments",function($scope,$routeParams,Comments){$scope.comment={},$scope.create=function(){var comment=new Comments({content:$scope.comment.content});comment.$save({postId:$routeParams.postId},function(respond){$scope.comment={},$scope.comments.splice(0,0,respond)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){$scope.comments=Comments.query({postId:$routeParams.postId})}}]),angular.module("posts").controller("PostsController",["$scope","$routeParams","$location","Posts","Authentication","$http",function($scope,$routeParams,$location,Posts,Authentication,$http){$scope.authentication=Authentication,$scope.post={},$scope.loading=!0,$scope.create=function(){var uploadUrl="/api/posts",data=$scope.post,fd=new FormData;for(var key in data)fd.append(key,data[key]);$http.post(uploadUrl,fd,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(response){$location.path("posts/"+response._id)}).error(function(errorResponse){$scope.error=errorResponse.message})},$scope.find=function(){$scope.posts=Posts.query(function(){$scope.loading=!1})},$scope.findOne=function(){$scope.post=Posts.get({postId:$routeParams.postId})},$scope.update=function(){$scope.post.$update(function(response){$location.path("posts/"+$scope.post._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope["delete"]=function(post){post?post.$remove(function(){for(var i in $scope.posts)$scope.posts[i]===post&&$scope.posts.slice(i,1)}):$scope.post.$remove(function(){$location.path("/")})}}]),angular.module("posts").directive("fileModel",["$parse",function($parse){return{restrict:"A",link:function(scope,element,attrs){var model=$parse(attrs.fileModel),modelSetter=model.assign;element.bind("change",function(){scope.$apply(function(){modelSetter(scope,element[0].files[0])})})}}}]),angular.module("posts").factory("Comments",["$resource",function($resource){return $resource("api/posts/:postId/comments",{postId:"@_id"},{update:{method:"PUT"}})}]),angular.module("posts").factory("Posts",["$resource",function($resource){return $resource("api/posts/:postId",{postId:"@_id"},{update:{method:"PUT"}})}]),angular.module("profile").config(["$routeProvider",function($routeProvider){$routeProvider.when("/profile",{templateUrl:"js/profile/views/profile-view.client.view.html"}).when("/profile/edit",{templateUrl:"js/profile/views/profile-edit.client.view.html"}).when("/profile/edit/password",{templateUrl:"js/profile/views/profile-edit-password.client.view.html"})}]),angular.module("profile").controller("ChangePassController",["$scope","$http","$window",function($scope,$http,$window){$scope.credentionals={},$scope.changePassword=function(){$scope.credentionals.oldPass?$scope.credentionals.newPass?$scope.credentionals.newPass!==$scope.credentionals.confirmPass?$scope.error="new & confirm password do not match":$http.put("/api/users/profile/changePassword",$scope.credentionals).success(function(){$window.location.href="/"}).error(function(err){$scope.error=err.message}):$scope.error="Please enter your new password":$scope.error="Please enter your old password"}}]),angular.module("profile").controller("EditprofileController",["$scope","$http","$window","Authentication",function($scope,$http,$window,Authentication){$scope.profile={username:Authentication.user.username,firstName:Authentication.user.firstName,lastName:Authentication.user.lastName,email:Authentication.user.email},$scope.editProfile=function(){var data=$scope.profile,fd=new FormData;for(var key in data)fd.append(key,data[key]);$http.put("/api/users/profile/edit",fd,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(response){$window.location.href="/"}).error(function(errorResponse){$scope.error=errorResponse.message})}}]),angular.module("users").controller("UsersController",["$scope","Authentication",function($scope,Authentication){$scope.authentication=Authentication}]),angular.module("users").factory("Authentication",[function(){return this.user=window.user,{user:this.user}}]);